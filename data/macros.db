{"name":"Effect: Rage","type":"script","author":"4yCBDF9see6CSU03","img":"https://assets.forge-vtt.com/bazaar/systems/pf2e/assets/icons/features/classes/rage.webp","scope":"global","command":"const ITEM_UUID = 'Compendium.pf2e.feature-effects.z3uyCMBddrPK5umr'; // Effect: Rage\n(async () => {\n  const effect = duplicate(await fromUuid(ITEM_UUID));\n  effect.flags.core = effect.flags.core ?? {};\n  effect.flags.core.sourceId = ITEM_UUID;\n  for await (const token of canvas.tokens.controlled) {\n    const existing = token.actor.items.find(i => i.type === 'effect' && i.data.flags.core?.sourceId === ITEM_UUID);\n    if (existing) {\n      existing.delete();\n    } else {\n      Item.create(effect, { parent: token.actor });\n    }\n  }\n})();","folder":null,"sort":0,"permission":{"default":0,"4yCBDF9see6CSU03":3},"flags":{},"_id":"1lSJl9E0V2sU7gHy"}
{"name":"New Macro","type":"chat","author":"izrimjovjPlemxTD","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"izrimjovjPlemxTD":3},"flags":{},"_id":"5bnaHcKkfgpBtTn0"}
{"name":"Strike: Unarmed Attack","type":"script","author":"bL4m8T94kYDMr79h","img":"systems/pf2e/icons/features/classes/powerful-fist.webp","scope":"global","command":"game.pf2e.rollActionMacro('DLEqeBGLt33EJR1f', 2, \"Unarmed Attack\")","folder":null,"sort":0,"permission":{"default":0,"bL4m8T94kYDMr79h":3},"flags":{"pf2e":{"actionMacro":true}},"_id":"8alHix6PzEt8Zse3"}
{"_id":"IbeyHHUcdkg1q6Ug","name":"2 Action Heal","type":"chat","author":"EnZ6Ev1ioEPkXkvt","img":"icons/svg/dice-target.svg","scope":"global","command":"/r 1d8+8","folder":null,"sort":0,"permission":{"default":0,"EnZ6Ev1ioEPkXkvt":3},"flags":{}}
{"_id":"JJnyh6wGFN2gItlg","name":"Doors","type":"script","author":"4yCBDF9see6CSU03","img":"icons/svg/dice-target.svg","scope":"global","command":"const doors = canvas.walls.placeables.filter(wall => wall.data.door === CONST.WALL_DOOR_TYPES.DOOR); // here we filter out only the doors from all the walls.\nlet updates = [];\nif (doors[0].data.ds === CONST.WALL_DOOR_STATES.OPEN){\n    updates = doors.map(door => ({ _id: door.id, ds: CONST.WALL_DOOR_STATES.CLOSED }))\n}\nelse {\n    updates = doors.map(door => ({ _id: door.id, ds: CONST.WALL_DOOR_STATES.OPEN}))\n}\nawait canvas.scene.updateEmbeddedDocuments(\"Wall\", updates);","folder":null,"sort":0,"permission":{"default":0,"4yCBDF9see6CSU03":3},"flags":{}}
{"name":"Effect: Rage","type":"script","author":"4yCBDF9see6CSU03","img":"https://assets.forge-vtt.com/bazaar/systems/pf2e/assets/icons/features/classes/rage.webp","scope":"global","command":"const ITEM_UUID = 'Compendium.pf2e.feature-effects.z3uyCMBddrPK5umr'; // Effect: Rage\n(async () => {\n  const effect = duplicate(await fromUuid(ITEM_UUID));\n  effect.flags.core = effect.flags.core ?? {};\n  effect.flags.core.sourceId = ITEM_UUID;\n  for await (const token of canvas.tokens.controlled) {\n    const existing = token.actor.items.find(i => i.type === 'effect' && i.data.flags.core?.sourceId === ITEM_UUID);\n    if (existing) {\n      existing.delete();\n    } else {\n      Item.create(effect, { parent: token.actor });\n    }\n  }\n})();","folder":null,"sort":0,"permission":{"default":0,"4yCBDF9see6CSU03":3},"flags":{},"_id":"LodTFQsYZlvFbjBb"}
{"name":"Lay on Hands","type":"script","author":"bL4m8T94kYDMr79h","img":"https://assets.forge-vtt.com/bazaar/systems/pf2e/assets/icons/spells/lay-on-hands.webp","scope":"global","command":"game.pf2e.rollItemMacro(\"RFjONuTduTKREZMJ\");","folder":null,"sort":0,"permission":{"default":0,"bL4m8T94kYDMr79h":3},"flags":{"pf2e":{"itemMacro":true}},"_id":"LxtNVK6yRQLz4zxO"}
{"name":"Effect: Rage","type":"script","author":"4yCBDF9see6CSU03","img":"https://assets.forge-vtt.com/bazaar/systems/pf2e/assets/icons/features/classes/rage.webp","scope":"global","command":"game.pf2e.rollItemMacro(\"Xe0ujOsE5eJ8b4ul\");","folder":null,"sort":0,"permission":{"default":0,"4yCBDF9see6CSU03":3},"flags":{"pf2e":{"itemMacro":true}},"_id":"NWf50MCsBX0sZq9X"}
{"name":"Strike: Dagger","type":"script","author":"bL4m8T94kYDMr79h","img":"https://assets.forge-vtt.com/bazaar/systems/pf2e/assets/icons/equipment/weapons/dagger.webp","scope":"global","command":"game.pf2e.rollActionMacro('DLEqeBGLt33EJR1f', 1, \"Dagger\")","folder":null,"sort":0,"permission":{"default":0,"bL4m8T94kYDMr79h":3},"flags":{"pf2e":{"actionMacro":true}},"_id":"O4r702oeosYf5rsX"}
{"name":"Add Persistent Damage","type":"script","author":"4yCBDF9see6CSU03","img":"https://assets.forge-vtt.com/bazaar/systems/pf2e/assets/icons/features/classes/brutality.webp","scope":"global","command":"PF2EPersistentDamage.showDialog();","folder":null,"sort":0,"permission":{"default":1,"4yCBDF9see6CSU03":3},"flags":{"core":{"sourceId":"Compendium.pf2e-persistent-damage.pf2e-persistent-damage-macros.pwyjwfc6dyf73p7f"}},"_id":"SiMWonEuNFVdImgS"}
{"name":"Strike: Shield Bash","type":"script","author":"bL4m8T94kYDMr79h","img":"https://assets.forge-vtt.com/bazaar/systems/pf2e/assets/icons/equipment/weapons/shield-bash.webp","scope":"global","command":"game.pf2e.rollActionMacro('DLEqeBGLt33EJR1f', 2, \"Shield Bash\")","folder":null,"sort":0,"permission":{"default":0,"bL4m8T94kYDMr79h":3},"flags":{"pf2e":{"actionMacro":true}},"_id":"WOSwmRpfpju75f72"}
{"name":"Strike: Wyrmbane","type":"script","author":"bL4m8T94kYDMr79h","img":"https://assets.forge-vtt.com/bazaar/systems/pf2e/assets/icons/equipment/weapons/longsword.webp","scope":"global","command":"game.pf2e.rollActionMacro('DLEqeBGLt33EJR1f', 0, \"Wyrmbane\")","folder":null,"sort":0,"permission":{"default":0,"bL4m8T94kYDMr79h":3},"flags":{"pf2e":{"actionMacro":true}},"_id":"tGSuzCLh4nGQADpI"}
{"name":"Strike: Unarmed Attack","type":"script","author":"bL4m8T94kYDMr79h","img":"systems/pf2e/icons/features/classes/powerful-fist.webp","scope":"global","command":"game.pf2e.rollActionMacro('DLEqeBGLt33EJR1f', 3, \"Unarmed Attack\")","folder":null,"sort":0,"permission":{"default":0,"bL4m8T94kYDMr79h":3},"flags":{"pf2e":{"actionMacro":true}},"_id":"v8e6yYYiUzEFTddV"}
{"name":"Raise a Shield","type":"script","author":"EnZ6Ev1ioEPkXkvt","img":"https://assets.forge-vtt.com/bazaar/systems/pf2e/assets/icons/actions/raise-a-shield.webp","scope":"global","command":"game.pf2e.actions.raiseAShield({ actors: [token?.actor ?? actor ?? game.user.character].filter((actor) => actor) })","folder":null,"sort":0,"permission":{"default":1,"EnZ6Ev1ioEPkXkvt":3},"flags":{"core":{"sourceId":"Compendium.pf2e.action-macros.4hfQEMiEOBbqelAh"}},"_id":"xjQHHsKnO507gUYH"}
{"name":"XP","type":"script","author":"4yCBDF9see6CSU03","img":"https://assets.forge-vtt.com/bazaar/systems/pf2e/assets/icons/spells/athletic-rush.webp","scope":"global","command":"/**\n * @typedef {{data: {data: {details: {level: number|string|undefined|null, isComplex: boolean}}, type: string}}} Hazard\n */\n\n/**\n * @param actors {Array<Hazard>}\n * @param type {string}\n * @returns {Array<HazardLevel>}\n */\nfunction getHazardLevels(actors, type) {\n    return actors\n        .filter((a) => a.data.type === type)\n        .map((a) => {\n            return {\n                level: parseInt(a.data.data.details.level ?? 1, 10),\n                isComplex: a.data.data.details.isComplex ?? false,\n            };\n        });\n}\n\n/**\n * @typedef {{data: {data: {details: {level: {value: number|string|undefined|null}}}, type: string}}} Actor\n */\n\n/**\n * @param actors {Array<Actor>}\n * @param type {string}\n * @returns {Array<number>}\n */\nfunction getLevels(actors, type) {\n    return actors.filter((a) => a.data.type === type).map((a) => parseInt(a.data.data.details.level.value ?? '1', 10));\n}\n\n/**\n * @param xp {XP}\n * @returns {string}\n */\nfunction dialogTemplate(xp) {\n    return `\n<h2>XP</h2>\n<table>\n    <tr>\n        <th>Party</th>\n        <td>PCs: ${xp.partySize} (Lv ${xp.partyLevel})</td>\n    </tr>\n    <tr>\n        <th>Rating</th>\n        <td>${xp.rating} (${xp.xpPerPlayer} XP)</td>\n    </tr>\n    <tr>\n        <th>Total XP</th>\n        <td>PCs: ${xp.encounterBudgets.moderate} XP, NPCs & Hazards: ${xp.totalXP} XP</td>\n    </tr>\n</table>\n<h2>Budgets</h2>\n<table>\n    <tr>\n        <th>Trivial</th>\n        <td>${xp.encounterBudgets.trivial} XP</td>\n    </tr>\n    <tr>\n        <th>Low</th>\n        <td>${xp.encounterBudgets.low} XP</td>\n    </tr>\n    <tr>\n        <th>Moderate</th>\n        <td>${xp.encounterBudgets.moderate} XP</td>\n    </tr>\n    <tr>\n        <th>Severe</th>\n        <td>${xp.encounterBudgets.severe} XP</td>\n    </tr>\n    <tr>\n        <th>Extreme</th>\n        <td>${xp.encounterBudgets.extreme} XP</td>\n    </tr>\n</table>`;\n}\n\nconst askLevelPopupTemplate = () => {\n    const partySize = parseInt(localStorage.getItem('xpMacroPartySize') ?? 4, 10);\n    const partyLevel = parseInt(localStorage.getItem('xpMacroPartyLevel') ?? 1, 10);\n    return `\n    <form>\n    <div class=\"form-group\">\n        <label>Party Size</label>\n        <input id=\"party-size\" name=\"party-size\" type=\"number\" value=\"${partySize}\">\n    </div>\n    <div class=\"form-group\">\n        <label>Party level</label>\n        <input id=\"party-level\" name=\"party-level\" type=\"number\" value=\"${partyLevel}\">\n    </div>\n    </form>\n    `;\n};\n\n/**\n * @param partyLevel {number}\n * @param partySize {number}\n * @param npcLevels {Array<number>}\n * @param hazardLevels {Array<HazardLevel>}\n */\nfunction showXP(partyLevel, partySize, npcLevels, hazardLevels) {\n    const xp = game.pf2e.gm.calculateXP(partyLevel, partySize, npcLevels, hazardLevels, {\n        proficiencyWithoutLevel: game.settings.get('pf2e', 'proficiencyVariant') === 'ProficiencyWithoutLevel',\n    });\n    new Dialog({\n        title: 'XP',\n        content: dialogTemplate(xp),\n        buttons: {},\n    }).render(true);\n}\n\n/**\n * @param npcLevels {Array<number>}\n * @param hazardLevels {Array<HazardLevel>}\n */\nfunction askPartyLevelAndSize(npcLevels, hazardLevels) {\n    new Dialog({\n        title: 'Party Information',\n        content: askLevelPopupTemplate,\n        buttons: {\n            no: {\n                icon: '<i class=\"fas fa-times\"></i>',\n                label: 'Cancel',\n            },\n            yes: {\n                icon: '<i class=\"fas fa-calculator\"></i>',\n                label: 'Calculate XP',\n                callback: ($html) => {\n                    const partySize = parseInt($html[0].querySelector('[name=\"party-size\"]').value, 10) ?? 1;\n                    const partyLevel = parseInt($html[0].querySelector('[name=\"party-level\"]').value, 10) ?? 1;\n                    // persist for future uses\n                    localStorage.setItem('xpMacroPartySize', partySize);\n                    localStorage.setItem('xpMacroPartyLevel', partyLevel);\n                    showXP(partyLevel, partySize, npcLevels, hazardLevels);\n                },\n            },\n        },\n        default: 'yes',\n    }).render(true);\n}\n\nfunction main() {\n    const actors = canvas.tokens.controlled.map((a) => a.actor);\n\n    const npcLevels = getLevels(actors, 'npc');\n    const pcLevels = getLevels(actors, 'character');\n    const hazardLevels = getHazardLevels(actors, 'hazard');\n\n    if (npcLevels.length === 0 && hazardLevels.length === 0) {\n        ui.notifications.error(`You must select at least one npc and/or hazard token and optionally all PC tokens`);\n        return;\n    }\n\n    if (pcLevels.length === 0) {\n        askPartyLevelAndSize(npcLevels, hazardLevels);\n    } else {\n        showXP(pcLevels[0], pcLevels.length, npcLevels, hazardLevels);\n    }\n}\n\nmain();","folder":null,"sort":0,"permission":{"default":0,"4yCBDF9see6CSU03":3},"flags":{"core":{"sourceId":"Compendium.pf2e.pf2e-macros.MAHxEeGf31wqv3jp"}},"_id":"yBnUtQjZQR9MJ9BM"}
{"name":"Toggle Mountain Stance","type":"script","author":"KIwV5H1JfjRzcUlJ","img":"https://assets.forge-vtt.com/bazaar/systems/pf2e/assets/icons/features/feats/mountain-stance.webp","scope":"global","command":"let ITEM_UUID = 'Compendium.pf2e.feat-effects.gYpy9XBPScIlY93p'; // Stance: Mountain Stance\n\nfunction checkFeat(slug) {\n    if (token.actor.items.find((i) => i.data.data.slug === slug && i.type === 'feat')) {\n        return true;\n    }\n    return false;\n}\n\nif (checkFeat('mountain-stronghold')) {\n    ITEM_UUID = 'Compendium.pf2e.feat-effects.LXbVcutEIW8eWZEz';\n}\nif (checkFeat('mountain-quake')) {\n    ITEM_UUID = 'Compendium.pf2e.feat-effects.wuERa7exfXXl6I37';\n}\n\n(async () => {\n    const effect = duplicate(await fromUuid(ITEM_UUID));\n    effect.flags.core = effect.flags.core ?? {};\n    effect.flags.core.sourceId = effect.flags.core.sourceId ?? ITEM_UUID;\n    for await (const token of canvas.tokens.controlled) {\n        let existing = token.actor.items.find(\n            (i) => i.type === 'effect' && i?.data?.flags?.core?.sourceId === ITEM_UUID,\n        );\n        if (existing) {\n            token.actor.deleteOwnedItem(existing._id);\n        } else {\n            let clothingPotency = 0;\n            const clothing = token.actor.items\n                .filter((item) => item.data.type === 'armor')\n                ?.filter((item) => item.data.data.slug === 'clothing-explorers')\n                ?.find((item) => item.data.data.equipped.value);\n            if (clothing) {\n                clothingPotency = parseInt(clothing.data?.data?.potencyRune?.value);\n            }\n            let bracers = token.actor.items\n                .filter((item) => item.data.type === 'equipment')\n                ?.filter((item) => item.data.data.slug === 'bracers-of-armor-i')\n                ?.filter((item) => item.data.data.equipped.value)\n                ?.find((item) => item.data.data.invested.value)\n                ? 1\n                : 0;\n            bracers = token.actor.items\n                .filter((item) => item.data.type === 'equipment')\n                ?.filter((item) => item.data.data.slug === 'bracers-of-armor-ii')\n                ?.filter((item) => item.data.data.equipped.value)\n                ?.find((item) => item.data.data.invested.value)\n                ? 2\n                : bracers;\n            bracers = token.actor.items\n                .filter((item) => item.data.type === 'equipment')\n                ?.filter((item) => item.data.data.slug === 'bracers-of-armor-iii')\n                ?.filter((item) => item.data.data.equipped.value)\n                ?.find((item) => item.data.data.invested.value)\n                ? 3\n                : bracers;\n            let mageArmorBonus = 0;\n            const mageArmor = token.actor.items\n                .filter((item) => item.data.type === 'effect')\n                ?.find((item) => item.data.data.slug === 'spell-effect-mage-armor');\n            if (mageArmor) {\n                mageArmorBonus = mageArmor.data.data.level.value === 10 ? 3 : mageArmor.data.data.level.value >= 5 ? 2 : 1;\n            }\n            let itemBonus = Math.max(bracers, clothingPotency, mageArmorBonus);\n            const rule = effect.data.rules.find(\n                (r) => r.selector === 'ac' && r.key === 'PF2E.RuleElement.FlatModifier',\n            );\n            if (rule) {\n                rule.value = rule.value + itemBonus;\n            }\n            token.actor.createOwnedItem(effect);\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"KIwV5H1JfjRzcUlJ":3},"flags":{"core":{"sourceId":"Compendium.pf2e.pf2e-macros.4nEbRlo2cB9KkK7T"}},"_id":"yjeo0ll1GYgjcG4P"}
